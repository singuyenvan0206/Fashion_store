<Window x:Class="WpfApp1.ReportsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:oxy="http://oxyplot.org/wpf"
        Title="Báo Cáo và Thống Kê" Height="800" Width="1280"
        WindowStartupLocation="CenterScreen">

    <Grid Background="#F5F5F5">
        <Grid.Resources>
            <Style x:Key="RightAlignedCell" TargetType="TextBlock">
                <Setter Property="TextAlignment" Value="Right"/>
            </Style>
            <Style x:Key="KpiCard" TargetType="Border">
                <Setter Property="Background" Value="White"/>
                <Setter Property="CornerRadius" Value="16"/>
                <Setter Property="Padding" Value="18"/>
                <Setter Property="Margin" Value="8"/>
            </Style>
        </Grid.Resources>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Header -->
        <Border Grid.Row="0" Background="#1CB5E0" Padding="16">
            <TextBlock Text="📊 Báo Cáo và Thống Kê"
                       FontSize="22"
                       FontWeight="Bold"
                       Foreground="White"
                       HorizontalAlignment="Center"/>
        </Border>

        <!-- Filters -->
        <Border Grid.Row="1" Margin="20,16,20,8" Background="White" CornerRadius="12" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="180"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="260"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock Grid.Column="0" Text="Từ:" VerticalAlignment="Center"/>
                <DatePicker x:Name="FromDatePicker" Grid.Column="1" SelectedDateChanged="FilterChanged"/>
                <TextBlock Grid.Column="2" Text="Đến:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                <DatePicker x:Name="ToDatePicker" Grid.Column="3" SelectedDateChanged="FilterChanged"/>
                <TextBlock Grid.Column="4" Text="Khách hàng:" VerticalAlignment="Center" Margin="12,0,0,0"/>
                <ComboBox x:Name="CustomerComboBox" Grid.Column="5" DisplayMemberPath="Name" SelectedValuePath="Id" SelectionChanged="FilterChanged"/>
                <TextBox x:Name="SearchTextBox" Grid.Column="6" Height="28" Margin="12,0,12,0" TextChanged="FilterChanged" 
                         ToolTip="Tìm theo mã KH, tên KH hoặc số hóa đơn"/>
                <StackPanel Grid.Column="7" Orientation="Horizontal">
                    <Button Content="Hôm nay" Margin="0,0,6,0" Click="RefreshButton_Click"/>
                    <Button Content="7 ngày" Margin="0,0,6,0" Click="RefreshButton_Click"/>
                    <Button Content="30 ngày" Click="RefreshButton_Click"/>
                </StackPanel>
                <Button Grid.Column="8" Content="Xuất CSV" Width="110" Margin="8,0,0,0" Click="ExportCsvButton_Click"/>
            </Grid>
        </Border>

        <!-- Data & Charts -->
        <Grid Grid.Row="2" Margin="20,8,20,8">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="2*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <!-- KPI Cards -->
            <Grid Grid.Row="0" Margin="0,0,0,8">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Border Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="📈 Doanh thu" Foreground="#777" FontSize="12"/>
                        <TextBlock x:Name="KpiRevenueText" Text="0₫" FontSize="24" FontWeight="Bold" Foreground="#059669"/>
                    </StackPanel>
                </Border>
                <Border Grid.Column="1" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="🧾 Số hóa đơn" Foreground="#777" FontSize="12"/>
                        <TextBlock x:Name="KpiInvoiceCountText" Text="0" FontSize="24" FontWeight="Bold" Foreground="#0D9488"/>
                    </StackPanel>
                </Border>
                <Border Grid.Column="2" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="👥 Khách hàng" Foreground="#777" FontSize="12"/>
                        <TextBlock x:Name="KpiCustomerCountText" Text="0" FontSize="24" FontWeight="Bold" Foreground="#2563EB"/>
                    </StackPanel>
                </Border>
                <Border Grid.Column="3" Style="{StaticResource KpiCard}">
                    <StackPanel>
                        <TextBlock Text="💸 Giảm giá" Foreground="#777" FontSize="12"/>
                        <TextBlock x:Name="KpiDiscountText" Text="0₫" FontSize="24" FontWeight="Bold" Foreground="#DC2626"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Invoices DataGrid -->
            <Border Grid.Row="1" Background="White" CornerRadius="12" Padding="12" Margin="0,0,0,8">
                <DataGrid x:Name="InvoicesDataGrid"
                          AutoGenerateColumns="False"
                          CanUserAddRows="False"
                          SelectionMode="Single"
                          EnableRowVirtualization="True"
                          EnableColumnVirtualization="True">
                    <DataGrid.Columns>
                        <DataGridTextColumn Header="#" Binding="{Binding Id}" Width="60" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Ngày" Binding="{Binding CreatedDate, StringFormat=yyyy-MM-dd HH:mm}" Width="160" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Khách hàng" Binding="{Binding CustomerName}" Width="*" IsReadOnly="True"/>
                        <DataGridTextColumn Header="Tạm tính" Binding="{Binding Subtotal, StringFormat=N2}" Width="120" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource RightAlignedCell}"/>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Thuế" Binding="{Binding TaxAmount, StringFormat=N2}" Width="110" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource RightAlignedCell}"/>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Giảm giá" Binding="{Binding Discount, StringFormat=N2}" Width="120" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource RightAlignedCell}"/>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Tổng cộng" Binding="{Binding Total, StringFormat=N2}" Width="120" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource RightAlignedCell}"/>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTextColumn Header="Đã trả" Binding="{Binding Paid, StringFormat=N2}" Width="120" IsReadOnly="True">
                            <DataGridTextColumn.ElementStyle>
                                <Style TargetType="TextBlock" BasedOn="{StaticResource RightAlignedCell}"/>
                            </DataGridTextColumn.ElementStyle>
                        </DataGridTextColumn>
                        <DataGridTemplateColumn Header="Thao tác" Width="200">
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <Button Content="Chi tiết" Click="DetailsButton_Click"/>
                                        <Button Content="In" Margin="6,0,0,0" Click="PrintButton_Click"/>
                                        <Button Content="Xóa" Margin="6,0,0,0" Background="#FC5C7D" Foreground="White" Click="DeleteButton_Click"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>
                </DataGrid>
            </Border>

            <!-- Charts -->
            <Grid Grid.Row="2">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>
                <Border Background="White" CornerRadius="12" Padding="12" Margin="0,0,8,0">
                    <StackPanel>
                        <TextBlock Text="Doanh Thu (30 Ngày Gần Đây)" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <oxy:PlotView x:Name="RevenuePlot" Height="240"/>
                    </StackPanel>
                </Border>
                <Border Grid.Column="1" Background="White" CornerRadius="12" Padding="12" Margin="8,0,0,0">
                    <StackPanel>
                        <TextBlock Text="Sản Phẩm Bán Chạy (SL)" FontWeight="SemiBold" Margin="0,0,0,8"/>
                        <oxy:PlotView x:Name="TopProductsPlot" Height="240"/>
                    </StackPanel>
                </Border>
            </Grid>
        </Grid>

        <!-- Summary -->
        <Border Grid.Row="3" Margin="20,8,20,20" Background="White" CornerRadius="12" Padding="12">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>
                <TextBlock x:Name="StatusTextBlock" Grid.Column="0" Text="" VerticalAlignment="Center"/>
                <StackPanel Grid.Column="1" Orientation="Horizontal" VerticalAlignment="Center">
                    <TextBlock Text="Số lượng:" Margin="0,0,8,0"/>
                    <TextBlock x:Name="CountTextBlock" Margin="0,0,16,0"/>
                    <TextBlock Text="Doanh thu:" Margin="0,0,8,0"/>
                    <TextBlock x:Name="RevenueTextBlock"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</Window>
